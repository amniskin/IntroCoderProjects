<!DOCTYPE html>

<html>
  <head>
    <title>
      Electronic Life
    </title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/ico" href="http://www.fvi.edu/wp-content/themes/fvi/images/fav.ico">
    <link rel='import' id='templates-import' href='../../templates/projects.html'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel='stylesheet' href='../../style/style.css' type='text/css'>
    <script src='../../js/coder.js'></script>
    <script src='../../templates/projects.js'></script>
  </head>
  <body data-spy="scroll" data-target="#nav-container">
    <project-header tag="Let's make a game!" author="Aaron Niskin"></project-header>
    <project-intro>
    <p>In this project we'll be continuing the game from <a href='http://eloquentjavascript.net/07_elife.html'>Eloquent JavaScipt</a> called Electronic Life. If you have not yet checked out Elequent JavaScript, start <a href='http://eloquentjavascript.net/06_object.html'>here</a>. Read that section and then do the project in the next section. I cannot stress the benefits of reading the section before starting the project enough as his explanations are excellent. Once you've finished that project, come here and we'll make a decent looking GUI (Graphical User Interface) for our program.</p>
    </project-intro>
    <project-objectives>
      <ul>
        <li>A little more on Object Oriented programming</li>
        <li>Separation of concerns</li>
        <li>Make a decent looking UI for our game</li>
      </ul>
      <h4>For the A students:</h4>
      <ul>
        <li>More practice with functional programming</li>
      </ul>
    </project-objectives>
    <project-prereqs>
      <ul>
        <li><a href='http://eloquentjavascript.net/07_elife.html'>Electronic Life Project</a> completed</li>
        <li>Basic HTML, CSS</li>
        <li>Knowledge of Bootstrap's CSS framework</li>
        <li>Basic JavaScript</li>
      </ul>
    </project-prereqs>
    <project-step title="Animating the world">
      <p>When writing the project on the Eloquent JavaScript website, we didn't really have to worry about the animation part of things; that is because the author wrote the <code>animateWorld</code> for us. Well, since we're no longer working with his version, we're going to have to write this function ourselves. Luckily, this is not a very difficult task. The key thing is a JavaScript function called <code>setTimeout</code>.</p>
      <p>The <code>setTimeout</code> function takes two arguments, a function to run and a duration of how long to wait before running it. What function do you think we should run? Try to figure out how to use <code>setTimeout</code> to write our <code>animateWorld</code> function. Remember, <code>animateWorld</code> needs to take a "world" as an argument, make the world "take a turn" (whatever that may mean for this world), and display the result of this turn (for which we have been using <code>console.log(world.toString())</code> so far).</p>
      <pre class='hint blur'>function animateWorld(world) {
  setTimeout(function() {
    world.turn();
    console.log(world.toString());
    animateWorld(world);
  }, 500);
}</pre>
      <p>You may notice that we call the <code>animateWorld</code> function from within its very own definition. This is called "recursion" and it is a very useful tool in a programmer's toolbox. The basic idea here is that when the function is called, it will call itself again. That is why the turns keep on happening. Let's walk through this evaluation once...</p>
      <ul>The function is called, and evaluates to
        <li>
          <pre>wait 500 miliseconds then, 
  world.turn();
  console.log(world.toString());
  animateWorld(world);</pre>
        </li>
        <li style= "list-style:none;">==></li>
        <li>
          <pre>wait 500 miliseconds then, 
  world.turn();
  console.log(world.toString());
  wait 500 miliseconds then, 
    world.turn();
    console.log(world.toString());
    animateWorld(world);
          </pre>
        </li>
        <li style= "list-style:none;">==></li>
        <li>
          <pre>wait 500 miliseconds then, 
  world.turn();
  console.log(world.toString());
  wait 500 miliseconds then, 
    world.turn();
    console.log(world.toString());
    wait 500 miliseconds then, 
      world.turn();
      console.log(world.toString());
      animateWorld(world);
          </pre>
        </li>
      </ul>
      <p>and so on... But we see that the recursive call really just makes the program call the function every 500 miliseconds, which is exactly what we want!</p>
    </project-step>
    <project-step title="Gettin griddy with it">
      <p>Let's use our trusty friends over at <a href='http://getbootstrap.com'>bootstrap</a> to help us with our grid. Their grid system is a 12 column grid system, but does it have to be? I mean, it would behove us to have a much larger grid system. Granted, we could use columns within columns to achieve our goal, but it would be so much nicer if the grid system had as many columns as our game grid does. First, let's find out how many columns are in our game (this project will be using the tigers and herbavores version from one of the exercises at the end of the project). So go ahead and find out the grid width now.</p>
      <pre class='hint blur'>worldName.gird.width
==> 52</pre>
      <p>Now that we know how many columns we would like our grid to have, let's get a version of bootstrap with that number of columns. Try and figure out how to do that on the bootstrap webpage. Remember that we only want the grid from them. Nothing more. And don't forget to link the file in our HTML.</p>
      <div class='hint blur'><a href='http://getbootstrap.com/customize/'>http://getbootstrap.com/customize/</a>
        <p>In the checklist on the top (where it says "less files" and the second one that says "jQuery plugins"), make sure you uncheck all except the grid system.</p>
        <p>Next, go down to the grid system section <a href='http://getbootstrap.com/customize/#grid-system'>here</a>, and set the number of columns to 52 and the grid-gutter-width to 0px (so it looks good on mobile devices). Then click "compile and download" on the bottom of the page.</p>
        <p>Once you've done that, move the bootstrap.min.css file to within your project's directory and make sure to link css file in your HTML</p>
      </div>
    </project-step>
    <project-step title="Making our grid">
      <p>Now, we could hand-code this game board. We could go through, row by row, cell by cell, making each piece and giving each piece the correct class names and everything, but I don't know if you realized... There are over 500 cells and 12 rows. That's a whole lot of cells that I don't really feel like coding by hand. Luckily, we can use javascript and jQuery to help us with this (yes, it can be done without jQuery, but why would I want to do that?).</p>
      <p>First, let's make a div for us to put the gameboard in. We could just append the gameboard to the <code>body</code>, but I think it's nicer if we do it this way. that way we can have multiple games later on and not have to refactor any code. So, we are probably going to want to give this div some sort of identifying attribute. In my case, I know I'm only going to want one thing on this page, so I am just using the div with class "container-fluid" as my board container. I can call it by using <code>$(".container-fluid")</code>.</p>
      <p>Next, let's make a function named "makeBoard" that takes a "world" object as its argument. This function will eventually return the gameBoard jQuery DOM element.</p>
      <pre class='hint blur'>function makeBoard(world) {
}</pre>
      <p>Next, let's store some useful values as variables like, the world's width and height, and the jQuery DOM element that we want to put the grid in and return.</p>
      <pre class='hint blur'>var width  = world.grid.width,
    height = world.grid.height,
    board  = $("&#60;div class='gameBoard'>");</pre>
      <p>Now let's make a function that given two numbers, i and j, returns a jQuery DOM element that is a cell at row i and column j. This cell should have an ID that is descriptive of which cell it is (row and column are good cell identifiers). In my version, a cell in row 2 and column 5 would have id "2-5". I suggest doing that.</p>
      <pre class='hint blur'>function makeCell(i, j) {
  return $("&#60;div class='col-xs-1' id='" + i + "-" + "'>");
}</pre>
      <p>Great! Now let's make a function that given a number, i, returns the ith row! I think it would be nice if the rows had IDs too. Remember, the rows contain cells, so you'll have to call the <code>makeCell</code> function from within this function definition, but how?</p>
      <pre class='hint blur'>function makeRow(i) {
  var row = $("&#60;div class='row' id='" + i + "'>");
  for (var j = 0; j &#60; width; j++) {
    row.append(makeCell(i, j));
  }
  return row;
}</pre>
      <p>Great! Now that function returns complete rows! All that's left to do is fill in all the rows in our game board before we return it!</p>
      <pre class='hint blur'>for (var i = 0; i &#60; height; i++) {
  board.append(makeRow(i));
}

return board;</pre>
      <p>Now if we want to make a grid, we can just call:</p>
      <pre>$('boardContainerIdentifier').html(makeBoard(worldName));</pre>
      <div class='hint blur'>
        <p>It's good form to have the <code>makeRow</code> and <code>makeCell</code> functions within the scope of the larger <code>makeBoard</code> function like so:</p>
        <pre>function makeBoard(world) {
  var board  = $("&#60;div class='gameBoard'>"),
      width  = world.grid.width,
      height = world.grid.height;
  function makeCell(i, j) {
    return $("&#60;div class='col-xs-1' id='" + i + "-" + j + "'>");
  }
  function makeRow(i) {
    var row = $("&#60;div class='row' id='" + i + "'>");
    for (var j = 0; j &#60; width; j++) {
      row.append(makeCell(i, j));
    }
    return row;
  }
  for (var i = 0; i &#60; height; i++) {
    board.append(makeRow(i));
  }
  return board;
}</pre>
      </div>
    </project-step>
    <project-step title="Portraits">
      <p>Now that we've got our grid in place, let's start drawing out the board! To do this, we're probably going to want a method for our world that will edit the game board according to the current state of the world. So, let's make a new method for our World object called "draw". Since we want this method to edit the game board, we should probably have the method take the game board as a parameter.</p>
      <pre class='hint blur'>World.prototype.draw = function(gameBoard) {
  }</pre>
      <p>Now, </p>
    </project-step>
    <project-step title="">
    </project-step>
    <project-step title="">
    </project-step>
    <project-step title="">
    </project-step>
    <project-step title="">
    </project-step>
    <project-step title="">
    </project-step>
    <project-step title="">
    </project-step>
    <project-step title="">
    </project-step>
    <project-step title="">
    </project-step>
    <project-step title="">
    </project-step>
    <project-step title="">
    </project-step>
    <project-step title="">
    </project-step>
    <project-step title="">
    </project-step>
    <project-step title="">
    </project-step>
    <project-step title="" last="">
    </project-step>
  </body>
</html>
<script>
var plan = [
  "############################",
  "#      #    #      o      ##",
  "#                          #",
  "#          #####           #",
  "##         #   #    ##     #",
  "###           ##     #     #",
  "#           ###      #     #",
  "#   ####                   #",
  "#   ##       o             #",
  "# o  #         o       ### #",
  "#    #                     #",
  "############################"];

function Vector(x, y) {
  this.x = x;
  this.y = y;
}
Vector.prototype.plus = function(v) {
  return new Vector(this.x + v.x, this.y + v.y);
};

function Grid(width, height) {
  this.space = new Array(width * height);
  this.width = width;
  this.height = height;
}

Grid.prototype.isInside = function(vec) {
  return vec.x >= 0 && vec.x < this.width &&
         vec.y >= 0 && vec.y < this.height;
};
Grid.prototype.get = function(vec) {
  return this.space[vec.x + this.width * vec.y];
};
Grid.prototype.set = function(vec, value) {
  return this.space[vec.x + this.width * vec.y] = value;
};


var directions = {
  "n":  new Vector( 0, -1),
  "ne": new Vector( 1, -1),
  "e":  new Vector( 1,  0),
  "se": new Vector( 1,  1),
  "s":  new Vector( 0,  1),
  "sw": new Vector(-1,  1),
  "w":  new Vector(-1,  0),
  "nw": new Vector(-1, -1)
};

function randomElement(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

var directionNames = "n ne e se s sw w nw".split(" ");

function BouncingCritter() {
  this.direction = randomElement(directionNames);
};

BouncingCritter.prototype.act = function(view) {
  if (view.look(this.direction) != " ")
    this.direction = view.find(" ") || "s";
  return {type: "move", direction: this.direction};
};

function elementFromChar(legend, ch) {
  if (ch == " ")
    return null;
  var element = new legend[ch]();
  element.originChar = ch;
  return element;
}

function World(map, legend) {
  var grid = new Grid(map[0].length, map.length);
  this.grid = grid;
  this.legend = legend;

  map.forEach(function(line, y) {
    for (var x = 0; x < line.length; x++)
      grid.set(new Vector(x, y), elementFromChar(legend, line[x]));
  });
}


function charFromElement(element) {
  if (element == null)
    return " ";
  else
    return element.originChar;
}

World.prototype.toString = function() {
  var output = "";
  for (var y = 0; y < this.grid.height; y++) {
    for (var x = 0; x < this.grid.width; x++) {
      var element = this.grid.get (new Vector(x, y));
      output += charFromElement(element);
    }
    output += "\n";
  }
  return output;
};

function Wall() {}

var world = new World(plan, {
  "#": Wall,
  "o": BouncingCritter});
console.log(world.toString());

</script>
