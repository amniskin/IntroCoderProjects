<!DOCTYPE html>

<html>
  <head>
    <title>
      Pretty functional too
    </title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/ico" href="http://www.fvi.edu/wp-content/themes/fvi/images/fav.ico">
    <link rel='import' id='templates-import' href='/templates/projects.html'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel='stylesheet' href='/style/style.css' type='text/css'>
    <script src='/js/coder.js'></script>
  </head>
  <body data-spy="scroll" data-target="#nav-container" data-offset="70">
    <project-header tag="Making the the pretty functional" author="Aaron Niskin"></project-header>
    <project-intro>
      <p>In this project, we'll be learning how to make a custom back-end for a website. This back-end will be able to dynamically create webpages to show clients using the power of JavaScript. In particular, we'll be using a framework called NodeJS.</p>
    </project-intro>
    <project-objectives>
      <ul>
        <li>Get comfortable running services in Linux</li>
        <li>Get familiar with some basic NodeJS syntax</li>
        <li>Be able to execute some basic NodeJS functionality</li>
      </ul>
      <h4>For the A students:</h4>
      <ul>
        <li>Learn a bit of functional programming</li>
        <li>In particular, be able to use the <code>map</code> function</li>
      </ul>
    </project-objectives>
    <project-prereqs>
      <ul>
        <li>A front end website with a form that has the following name fields:
          <ul>
            <li><code>fname</code></li>
            <li><code>lname</code></li>
            <li><code>email</code></li>
            <li><code>supa</code></li>
            <li><code>checker</code></li>
            <li><code>lifter</code></li>
          </ul>
        </li>
        <li>Understanding of HTML forms and form submissions</li>
        <li>Basic JavaScript</li>
        <li>A port all of your own that nobody else will be using.</li>
      </ul>
      <p>That last one is very important. You don't want to be messing with a site's functionality! Be sure to check with your network administrator before you commandeer your favorite port.</p>
    </project-prereqs>
    <project-step title="Requiring packages">
      <p>Let's create a file called "NodeProject.js", or something descriptive. This is the file where we will be writing our back-end code that will hopefully run on our server for our site. Remember, at this point you should already have the front-end of your site already made.</p>
      <p>In this file, let's go ahead and <code>require</code> a package called "http" and store that in a variable called <code>http</code> or something similar. The syntax for requiring packages in Node is:</p>
      <pre>require(package-name-as-a-string);</pre>
      <p>So, in our case, our code should look like,</p>
      <pre>var http = require('http');</pre>
    </project-step>
    <project-step title="Create a server!">
      <p>Our <code>http</code> package has a method called <code>createServer</code>. It is that method we will be using to create our server today. Go ahead and call that method now.</p>
      <pre class='hint blur'>http.createServer();</pre>
      <p>Next, we're going to want to pass a function to the <code>createServer</code> method. This function takes two variables: the request and the response objects. So let's go ahead and pass that function now.</p>
      <pre class='hint blur'>http.createServer(function(request, response) {
  ---- Our code will go here ----
});</pre>
      <p>Now we're ready to start serving!</p>
    </project-step>
    <project-step title='Hello World (again)'>
      <p>First things first, let's send a code telling the client that the request was processed properly and without error. To do this, we need to edit the response object. In particular, we're going to want to execute</p>
      <pre>response.writeHead(200, {"Content-Type": "text/plain"});</pre>
      <p>If you wanted to write HTML code instead, you could just set the Content-Type value to <code>"text/html"</code>. For our project, we'll just be using plaintext because style is not an objective of this project.</p>
      <p>Okay! Now that we've sent a 200 response code and told the browser what type of data to expect, let's get something to show up on the page when we submit the form. Let's get the page to say "Hello, world!" or whatever your favorite phrase is. To do this, we're going to want to execute:</p>
      <pre>response.write("Hello, world!");
response.end();</pre>
      <p>The last line is pretty self explanatory. It puts the end in send response.</p>
    </project-step>
    <project-step title="Start listening!">
      <p>So now our code looks pretty good, but we still haven't told the application to start listening. We know this because we haven't even specified a port yet! To do this, we're going to want to add <code>.listen(port-number);</code> to the end our our <code>createServer</code> method call. Go ahead and do that.</p>
      <pre>http.createServer(function(request, response) {
  ...
}).listen(port-number);</pre>
      <p>Go ahead and submit your form and see what happens. Make sure the form action is not being impeeded by any JavaScript running on the page (e.g. any click handlers, etc).</p>
    </project-step>
    <project-step title="Let's give something back">
      <p>Let's make our code a little bit more dynamic. Rather than just sending back the same thing to everybody, let's send something unique back to every person. Just for starters, let's send back the query string that the client sent us just after we greet the world. Well, luckily, we have a way to get the URL pretty easily. Let's get the request's <code>url</code> attribute and store it in a variable (just in case we want to use it later).</p>
      <pre class='hint blur'>var url = request.url;</pre>
      <p>Now, in our <code>response.write</code> call, let's add a newline character after we greet our clients and concatinate it with the url string.</p>
      <pre class='hint blur'>response.write("Hello, world!\n" + url);</pre>
      <p>Our page should look a little bit like,</p>
      <project-img src='basicUrl.png' alt="screenshot of what the page should look like">
      <p>If you did the extra-credit part of the Pretty functional project, then you can use the function we wrote to turn the query string into a JavaScript object and do even more amazing things with it as in the "Try it out" link on this project.</p>
    </project-step>
    <project-step title="Go away, or..." last="true">
      <p>You can go away now. Or...</p>
      <p>Or...</p>
      <p>Or...</p>
      <p>Or you can stick around and learn a bit more!</p>
    </project-step>
    <project-step title="Objectifying strings">
    <p>Now that we've learned how to get the url string, let's split it up and add some seriously dynamic content! The query string probably looks a little something like "/?fname=Aaron&lname=Niskin&...&lifter=true" or something similar. Basically, we see that the string is a string of pairs: keys and their corresponding values. The pairs are organized as key=val, e.g. fname=Aaron, etc. Then the pairs are separated by ampersands. We would like to have a JavaScript object that looks like <code>{fname: "Aaron", lname: "Niskin", ..., lifter: "true"}</code>. The structure tells us that we are going to want to split up the string into an array of pairs, then split each pair and associate the pairs into a JavaScript object. This is the plan we will follow.</p>
    </project-step>
    <project-step title="Splitting up">
      <p>Let's start by splitting the string at each ampersand to get our array of pairs. To do this, we're going to want to use the string <code>split</code> method. If you are unsure of how it works search the bottomless abyss that is the internet for some guidance. Don't cheat yourself. Also, don't check reddit. It's not on there. I assure you. I've checked.</p>
      <pre class='hint blur'>url.split("&");</pre>
      <p>Now, normally we'd save that in a variable and work with that, but we're trying to learn a bit further, so let's not save it... Let's use chaining instead.</p>
    </project-step>
  </body>
</html>
